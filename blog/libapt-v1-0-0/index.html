<!doctype html><html data-theme=dark lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://lts-linux.eu/ name=base><title>LTS Linux ‚Ä¢ Libapt v1.0.0</title><link href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 105 55"><text y=".7em" font-size="82">üêß</text></svg>' rel=icon><link title="LTS Linux - Atom Feed" href=https://lts-linux.eu/atom.xml rel=alternate type=application/atom+xml><link href="https://lts-linux.eu/custom_subset.css?h=753f2b519893883e57d5" rel=stylesheet><link href="https://lts-linux.eu/main.css?h=2e02623b98889ce02fac" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="A first version if libapt is ready to use!" name=description><meta content="A first version if libapt is ready to use!" property=og:description><meta content="index, nofollow" name=robots><meta content="Libapt v1.0.0" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><link href=https://lts-linux.eublog/libapt-v1-0-0/ rel=canonical><meta content=https://lts-linux.eublog/libapt-v1-0-0/ property=og:url><meta content="LTS Linux" property=og:site_name><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self' https://cdn.jsdelivr.net/;style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://lts-linux.eu/no_js.css rel=stylesheet></noscript><script src=https://lts-linux.eu/js/initializeTheme.min.js></script><script defer src=https://lts-linux.eu/js/themeSwitcher.min.js></script><meta content=@ltslinux@social.tchncs.de name=fediverse:creator><script src="https://lts-linux.eu/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://lts-linux.eu>LTS Linux</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/blog/> Blog </a><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/archive/> Archiv </a><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/tags/> Tags </a><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/projects/> Topics </a><li class=js><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Libapt v1.0.0</h1><ul class=meta><li>By Tom Irgang</li>¬†‚Ä¢¬†<li>1 November 2024</li>¬†‚Ä¢¬†<li title="556 words">3 min read</li>¬†‚Ä¢¬†<li>Tags:¬†<li><a href=https://lts-linux.eu/tags/rust/>Rust</a>,¬†<li><a href=https://lts-linux.eu/tags/library/>library</a>,¬†<li><a href=https://lts-linux.eu/tags/apt/>APT</a>,¬†<li><a href=https://lts-linux.eu/tags/debian/>Debian</a></ul><section class=body><p>A first version of <em>libapt</em> is ready to use and published on <a href=https://crates.io/crates/libapt>crates.io</a>.<p>You can find the sources at <a href=https://codeberg.org/tomirgang/libapt>Codeberg</a> and <a href=https://github.com/lts-linux/libapt>Github</a>.<h2 id=architecture><a aria-label="Anchor link for: architecture" class="header-anchor no-hover-padding" href=#architecture><span aria-hidden=true class=link-icon></span></a> Architecture</h2><p><em>Libapt</em> provides a (almost) pure Rust interface for Debian repositories.<p>On my Ubuntu subsystem I had to install the following dependencies: - rust-lzma requires <em>liblzma-dev</em> and <em>pkg-config</em> - reqwest requires <em>libssl-dev</em><p>The goal of <em>libapt</em> is to provide a pure Rust library for interfacing with Debian apt repositories. It shall be possible to use <em>libapt</em> to parse an apt repository, get the packages, package metadata, checksums and locations, and verify the validity of the metadata with respect to signatures, compliance with the Debian repository format specification, and existence of packages indices and packages.<h4 id=struct-distro><a aria-label="Anchor link for: struct-distro" class="header-anchor no-hover-padding" href=#struct-distro><span aria-hidden=true class=link-icon></span></a> Struct Distro</h4><p>The struct [Distro] is the starting point to parse an apt repository. It groups all information which need to be provided by a user to locate and verify the <em>InRelease</em> distribution index.<p>For verifying the integrity of the distribution index, a public key needs to be provided. This pubic key can be armored public GPG key, e.g. form a URL or a local file, or a non-armored binary GPG key, e.g. form the local <code>/etc/apt/trusted.gpg.d/</code>. For receiving both types of keys, a download is tried if the provided string starts with ‚Äòhttp‚Äô, else the string is interpreted as a local path.<p>If no verification is wanted, the value <em>Key::NoSignatureCheck</em> can be provided.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">libapt<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>Distro<span class="z-punctuation z-separator z-rust">,</span> Key</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> key <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Key<span class="z-punctuation z-accessor z-rust">::</span></span>key<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>/etc/apt/trusted.gpg.d/ubuntu-keyring-2018-archive.gpg<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Default repository format using a public key form an URL.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> distro <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Distro<span class="z-punctuation z-accessor z-rust">::</span></span>repo<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>http://archive.ubuntu.com/ubuntu<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>jammy<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    key<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Flat repository format using a public key form an URL.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> distro <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Distro<span class="z-punctuation z-accessor z-rust">::</span></span>flat_repo<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>http://archive.ubuntu.com/ubuntu<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>dists/jammy<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    key<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Flat repo skipping verification.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> distro <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Distro<span class="z-punctuation z-accessor z-rust">::</span></span>flat_repo<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>http://archive.ubuntu.com/ubuntu<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>dists/jammy<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Key<span class="z-punctuation z-accessor z-rust">::</span></span>NoSignatureCheck<span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h4 id=struct-release><a aria-label="Anchor link for: struct-release" class="header-anchor no-hover-padding" href=#struct-release><span aria-hidden=true class=link-icon></span></a> Struct Release</h4><p>The struct [Release] groups all information contained in the InRelease file. When a new [Release] is created by running [Release::from_distro], the content of the InRelease file is downloaded, the inline signature is verified using the [Distro] key, and the content is parsed.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">libapt<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>Distro<span class="z-punctuation z-separator z-rust">,</span> Key<span class="z-punctuation z-separator z-rust">,</span> Release</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Ubuntu Jammy signing key.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> key <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Key<span class="z-punctuation z-accessor z-rust">::</span></span>key<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>/etc/apt/trusted.gpg.d/ubuntu-keyring-2018-archive.gpg<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Ubuntu Jammy distribution.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> distro <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Distro<span class="z-punctuation z-accessor z-rust">::</span></span>repo<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>http://archive.ubuntu.com/ubuntu<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>jammy<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    key<span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Parse the InRelease file.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> release <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Release<span class="z-punctuation z-accessor z-rust">::</span></span>from_distro<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>distro</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Check for compliance with https://wiki.debian.org/DebianRepository/Format#A.22Release.22_files.
</span></span><span class="z-source z-rust">release<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">check_compliance</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>The struct [Release] provides also some convenience methods to access the package indices.<p>The method [Release::get_package_links] provides all available package indices. This means, for each combination of architecture and component, the function [get_etag] is used to check if the URL really exists, and if the URL exists, the [Link] is provided. The return value of this method is a <em>Vec<(String, Architecture, Link)></em>, and each tuple consists of <em>component name</em>, <em>architecture</em>, and <em>URL to the index as [Link]</em>.<p>The method [Release::get_package_index_link] provides the [Link] to one specific package index. The parameters are the <em>component name</em> and the <em>architecture</em>, and the result is a <em>[Link]</em>.<h4 id=struct-link><a aria-label="Anchor link for: struct-link" class="header-anchor no-hover-padding" href=#struct-link><span aria-hidden=true class=link-icon></span></a> Struct Link</h4><p>The [Link] struct groups references to files, i.e. URLs, with the hash sums to verify the file, and the size of the file. The supported hash types are MD5, SHA1, SHA256 and SHA512. When the file is downloaded, the best available hash is verified to ensure the integrity.<h4 id=struct-packageindex><a aria-label="Anchor link for: struct-packageindex" class="header-anchor no-hover-padding" href=#struct-packageindex><span aria-hidden=true class=link-icon></span></a> Struct PackageIndex</h4><p>The struct [PackageIndex] groups all packages of one component and architecture. This structure also provides support for parsing the apt repository package index files.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">libapt<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>Distro<span class="z-punctuation z-separator z-rust">,</span> Key<span class="z-punctuation z-separator z-rust">,</span> Release<span class="z-punctuation z-separator z-rust">,</span> PackageIndex<span class="z-punctuation z-separator z-rust">,</span> Architecture</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Ubuntu Jammy signing key.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> key <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Key<span class="z-punctuation z-accessor z-rust">::</span></span>key<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>/etc/apt/trusted.gpg.d/ubuntu-keyring-2018-archive.gpg<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Ubuntu Jammy distribution.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> distro <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Distro<span class="z-punctuation z-accessor z-rust">::</span></span>repo<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>http://archive.ubuntu.com/ubuntu<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>jammy<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    key<span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Parse the InRelease file.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> release <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Release<span class="z-punctuation z-accessor z-rust">::</span></span>from_distro<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>distro</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Parse the package index of the main component for the amd64 architecture.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> main_amd64 <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">PackageIndex<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>release<span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>main<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-meta z-path z-rust">Architecture<span class="z-punctuation z-accessor z-rust">::</span></span>Amd64</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Ubuntu Jammy main provides <span class="z-constant z-other z-placeholder z-rust">{}</span> packages for amd64.<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> main_amd64<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">package_count</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Get a Package from the package index.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> busybox <span class="z-keyword z-operator z-assignment z-rust">=</span> main_amd64<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>busybox-static<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-type z-rust">None</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Ubuntu Jammy main provides busybox-static version <span class="z-constant z-other z-placeholder z-rust">{:?}</span>.<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> busybox<span class="z-punctuation z-accessor z-dot z-rust">.</span>version<span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h4 id=struct-package><a aria-label="Anchor link for: struct-package" class="header-anchor no-hover-padding" href=#struct-package><span aria-hidden=true class=link-icon></span></a> Struct Package</h4><p>The metadata about binary packages are grouped in the struct [Package]. The packages are parsed from the so called <em>stanzas</em> of the package indices.<h3 id=struct-sourceindex><a aria-label="Anchor link for: struct-sourceindex" class="header-anchor no-hover-padding" href=#struct-sourceindex><span aria-hidden=true class=link-icon></span></a> Struct SourceIndex</h3><p>The struct [SourceIndex] groups all source packages of one component. This structure also provides support for parsing the apt repository source package index files.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">libapt<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>Distro<span class="z-punctuation z-separator z-rust">,</span> Key<span class="z-punctuation z-separator z-rust">,</span> Release<span class="z-punctuation z-separator z-rust">,</span> SourceIndex</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Ubuntu Jammy signing key.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> key <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Key<span class="z-punctuation z-accessor z-rust">::</span></span>key<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>/etc/apt/trusted.gpg.d/ubuntu-keyring-2018-archive.gpg<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Ubuntu Jammy distribution.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> distro <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Distro<span class="z-punctuation z-accessor z-rust">::</span></span>repo<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>http://archive.ubuntu.com/ubuntu<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>jammy<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    key<span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Parse the InRelease file.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> release <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Release<span class="z-punctuation z-accessor z-rust">::</span></span>from_distro<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>distro</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Parse the package index of the main component for the amd64 architecture.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> main_sources <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">SourceIndex<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>release<span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>main<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Ubuntu Jammy main provides <span class="z-constant z-other z-placeholder z-rust">{}</span> source packages.<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> main_sources<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">package_count</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Get a Package from the package index.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> busybox <span class="z-keyword z-operator z-assignment z-rust">=</span> main_sources<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>busybox<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-type z-rust">None</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Ubuntu Jammy main provides busybox version <span class="z-constant z-other z-placeholder z-rust">{:?}</span>.<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> busybox<span class="z-punctuation z-accessor z-dot z-rust">.</span>version<span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h4 id=struct-source><a aria-label="Anchor link for: struct-source" class="header-anchor no-hover-padding" href=#struct-source><span aria-hidden=true class=link-icon></span></a> Struct Source</h4><p>The metadata about source packages are grouped in the struct [Source]. The source packages are parsed from the so called <em>stanzas</em> of the source package indices.</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://lts-linux.eu/blog/aptcheckr/><span class=arrow>‚Üê</span>¬†Next</a><p aria-hidden=true id=left_title>Aptcheckr</div><div><a aria-describedby=right_title aria-label=Prev href=https://lts-linux.eu/blog/libapt/>Prev¬†<span class=arrow>‚Üí</span></a><p aria-hidden=true id=right_title>Libapt</div></nav></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label class=overlay for=toc-toggle></label><label title="Toggle Table of Contents" class=button for=toc-toggle id=toc-button><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#architecture>Architecture</a> <ul><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-distro>Struct Distro</a><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-release>Struct Release</a><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-link>Struct Link</a><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-packageindex>Struct PackageIndex</a><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-package>Struct Package</a><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-sourceindex>Struct SourceIndex</a> <ul><li><a href=https://lts-linux.eu/blog/libapt-v1-0-0/#struct-source>Struct Source</a></ul></ul></ul></div></div></div><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://lts-linux.eu/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://lts-linux.eu/atom.xml> <img alt=feed loading=lazy src=https://lts-linux.eu/social_icons/rss.svg title=feed> </a><li class=js><a class="nav-links no-hover-padding social" data-encoded-email="Y29udGFjdEBsdHMtbGludXguZXU=" href=#><img alt=email loading=lazy src=https://lts-linux.eu/social_icons/email.svg title=email> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/lts-linux> <img alt=github loading=lazy src=https://lts-linux.eu/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://social.tchncs.de/@ltslinux> <img alt=mastodon loading=lazy src=https://lts-linux.eu/social_icons/mastodon.svg title=mastodon> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/about/> about </a><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/privacy/> privacy policy </a><li><a class="nav-links no-hover-padding" href=https://lts-linux.eu/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> <p><p>LTS Linux ¬© 2024 ‚Ä¢ Unless otherwise noted, the content in this website is available under the <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> license.</p> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> ‚Ä¢ <a href=https://github.com/lts-linux/lts-linux.github.io> Site source </a></small></div></section><script async src=https://lts-linux.eu/js/decodeMail.min.js></script><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search‚Ä¶ role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>